<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title></title>
    <style>
    .team-A {
     fill: #FA3EB8;
    }
    .team-K {
     fill: #77B800;
    }
    .team-B {
     fill: #34B6E4;
    }

    .team-4 {
      fill: Yellow; 
    }

    .team-E { 
      fill: #44aa22; 
    }
    .team-H { 
      fill: #009140;
    }
    .team-KII { 
      fill: Teal;
    }
    .team-N { 
      color: #333333;
    }
    .team-S {
      fill: Orange;
    }
    .team-SK { 
      fill: #aea9a2;
    }
    .team-kenkyuusei{ 
     fill: Red; 
    }
    </style>

    </head>

<body>
<script src="d3.v3.min.js"></script>
<script>
var margin = {top: 20, right: 20, bottom: 80, left: 50},
    width = 960 - margin.left - margin.right,
    height = 1200 - margin.top - margin.bottom;

var translate = function(x,y){               
  return "translate(" + x + "," + y + ")";
}

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", translate(margin.left, margin.top))

d3.csv("akb.csv", function(csvData){
   var data = d3.nest()
    .key(function(d){return d.Single})
    .key(function(d){return d.Rank})
    .rollup(function(d){ return {name: d[0].Name, votes: +d[0].Votes, team: d[0].Team}; })
    .entries(csvData);

  var sumVotes = function(single) {
    return single.values.reduce(function(sum, d){return d.values.votes + sum}, 0)
  }

  var y = d3.scale.linear()
          .range([0, height])
          .domain([0,d3.max(data.map(sumVotes))]);

  var singles = svg.selectAll(".single")
        .data(data,function(d,i) { return d.key; })
      .enter().append("g")
        .attr("class", "single")
        .attr("transform", function(d,i) { return translate(i * (width / data.length), 0)});

  data.map(function(d){
    var dx = 0;
    d.values.map(function(d){d.values.dx = dx; dx += y(d.values.votes) + 2.5; return d})
  });

  var entries = singles.selectAll("idol")
      .data(function(d){ return d.values })
    .enter().append("rect")
      .attr("height", function(d,i){ return y(d.values.votes) })
      .attr("width", 10)
      .attr("x", 0)
      .attr("y", function(d) { return d.values.dx})
      .attr("class", function(d){ return "team-"+d.values.team})

});
</script>
  
</body>
</html>
